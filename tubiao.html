<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>派单员对比分析 - 2x2图表视图</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Babel Standalone for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', sans-serif; }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom": "https://esm.sh/react-dom@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "recharts": "https://esm.sh/recharts@2.13.0?external=react,react-dom",
        "lucide-react": "https://esm.sh/lucide-react@0.460.0?external=react"
      }
    }
    </script>
</head>
<body class="bg-slate-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer 
        } from 'recharts';
        import { 
            BarChart2, Users
        } from 'lucide-react';

        // --- 1. 模拟数据逻辑 ---
        const NAMES = ['张伟', '李强', '王芳', '赵敏', '刘洋', '陈杰', '杨光', '黄婷'];
        
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        
        const generateMockData = () => {
            const data = [];
            NAMES.forEach((name, index) => {
                data.push({
                    id: String(index),
                    name: name,
                    successRate: getRandomInt(60, 95),
                    dispatchRate: getRandomInt(70, 98),
                    avgRevenue: getRandomInt(200, 500),
                    totalOrders: getRandomInt(30, 150),
                    // 仅用于生成 ID 区分
                    date: new Date().toISOString()
                });
            });
            return data;
        };

        const INITIAL_DATA = generateMockData();

        // --- 2. 图表组件 ---
        const MetricChart = ({ title, data, dataKey, color, unit = '', yDomain }) => (
            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col h-full hover:shadow-md transition-shadow">
                <div className="flex items-center gap-2 mb-4">
                    <div className="w-1 h-5 rounded-full" style={{ backgroundColor: color }}></div>
                    <h3 className="text-sm font-bold text-slate-700">{title}</h3>
                </div>
                <div className="h-64 flex-grow">
                    <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={data} margin={{ top: 10, right: 10, left: -20, bottom: 0 }} barSize={40}>
                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                            <XAxis 
                                dataKey="name" 
                                stroke="#94a3b8" 
                                fontSize={12} 
                                tickLine={false} 
                                axisLine={{ stroke: '#e2e8f0' }} 
                            />
                            <YAxis 
                                stroke="#94a3b8" 
                                fontSize={12} 
                                tickLine={false} 
                                axisLine={false} 
                                domain={yDomain || [0, 'auto']} 
                                tickFormatter={(value) => `${value}${unit.replace('¥', '')}`} 
                            />
                            <Tooltip 
                                cursor={{ fill: '#f8fafc' }}
                                contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)', fontSize: '12px' }} 
                                formatter={(value) => [`${unit}${value}`, title]}
                            />
                            <Bar dataKey={dataKey} fill={color} radius={[4, 4, 0, 0]} animationDuration={800} />
                        </BarChart>
                    </ResponsiveContainer>
                </div>
            </div>
        );

        // --- 3. 主页面 ---
        const ComparisonPage = () => {
            const [data] = useState(INITIAL_DATA);
            // 默认选中前4个数据，模拟用户选择了4个人
            const [selectedIds, setSelectedIds] = useState(new Set(['0', '1', '2', '3']));

            const selectedData = useMemo(() => {
                return data.filter(item => selectedIds.has(item.id));
            }, [data, selectedIds]);

            return (
                <div className="max-w-7xl mx-auto px-4 py-8">
                    
                    {/* Header */}
                    <div className="flex items-center justify-between mb-8">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-blue-100 rounded-lg">
                                <BarChart2 className="h-6 w-6 text-blue-600" />
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold text-slate-800">多维对比分析视图</h1>
                                <p className="text-slate-500 text-sm mt-1">
                                    当前对比人数：<span className="font-bold text-blue-600">{selectedData.length}</span> 人
                                </p>
                            </div>
                        </div>
                        
                        {/* 简单的人员切换器 (模拟选择) */}
                        <div className="flex gap-2">
                             {data.slice(0, 6).map(person => (
                                 <button
                                    key={person.id}
                                    onClick={() => {
                                        const newSet = new Set(selectedIds);
                                        if (newSet.has(person.id)) newSet.delete(person.id);
                                        else newSet.add(person.id);
                                        setSelectedIds(newSet);
                                    }}
                                    className={`px-3 py-1.5 text-sm rounded-lg transition-colors border ${
                                        selectedIds.has(person.id) 
                                        ? 'bg-blue-600 text-white border-blue-600' 
                                        : 'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'
                                    }`}
                                 >
                                    {person.name}
                                 </button>
                             ))}
                        </div>
                    </div>

                    {/* 
                        核心区域：2x2 图表布局 
                        grid-cols-2 强制一行两个
                    */}
                    {selectedData.length > 0 ? (
                        <div className="grid grid-cols-2 gap-6">
                            {/* 图表 1: 成单率 */}
                            <MetricChart 
                                title="成单率对比" 
                                data={selectedData} 
                                dataKey="successRate" 
                                color="#3b82f6" 
                                unit="%" 
                                yDomain={[0, 100]} 
                            />
                            
                            {/* 图表 2: 派单率 */}
                            <MetricChart 
                                title="派单率对比" 
                                data={selectedData} 
                                dataKey="dispatchRate" 
                                color="#10b981" 
                                unit="%" 
                                yDomain={[0, 100]} 
                            />
                            
                            {/* 图表 3: 业绩 */}
                            <MetricChart 
                                title="每单业绩对比" 
                                data={selectedData} 
                                dataKey="avgRevenue" 
                                color="#f59e0b" 
                                unit="¥" 
                            />
                            
                            {/* 图表 4: 总单量 */}
                            <MetricChart 
                                title="总单量对比" 
                                data={selectedData} 
                                dataKey="totalOrders" 
                                color="#6366f1" 
                                unit="" 
                            />
                        </div>
                    ) : (
                        <div className="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                            <Users className="h-10 w-10 text-slate-300 mx-auto mb-2" />
                            <p className="text-slate-500">请至少选择一名人员进行对比</p>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ComparisonPage />);
    </script>
</body>
</html>